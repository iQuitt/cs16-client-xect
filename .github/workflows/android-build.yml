name: Android Build
on:
  push:
    branches: [ master ]  #
  pull_request:
    branches: [ master ] 
  workflow_dispatch:

jobs:
  android-build:
    name: Android Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17' 

      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt-get install -y \
            gcc g++ clang \
            g++-multilib gcc-multilib \
            build-essential

      - name: Prepare NDK
        run: |
          cd android/jni
          rm -rf cs-client
          ln -s ../../ ./cs-client
          cd ../
          wget -q https://dl.google.com/android/repository/android-ndk-r23-linux.zip
          unzip -qq android-ndk-r23-linux.zip
          rm -rf android-ndk-r23-linux.zip
          export ANDROID_NDK_HOME=$GITHUB_WORKSPACE/android-ndk-r23

      - name: Build Project
        run: |
          cd $GITHUB_WORKSPACE
          ./build release noomp

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: android-libs
          path: android/libs/
